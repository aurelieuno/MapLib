{"version":3,"sources":["../src/Tokenizer.js"],"names":["KEY_TAB","KEY_ENTER","KEY_ESC","Tokenizer","placeholder","string","remoteOptionsUrl","queryParam","selectedItems","array","inputClassName","optionListClassName","optionClassName","tokenListClassName","tokenClassName","removeButtonClassName","leaveOpen","bool","getItemValue","func","getOptionComponent","getTokenComponent","getInputName","props","state","ignoreKeyUp","optionItems","item","id","map","bind","JSON","stringify","name","onRemove","refs","input","getDOMNode","onSelect","length","renderToken","renderOption","renderTokens","className","type","defaultValue","onKeyDown","onKeyUp","onBlur","onFocus","children","renderOptions","e","keyCode","isSelectKey","getInput","blur","fetchOptions","setState","clearOptions","setTimeout","xhr","abort","items","rejectItem","_","contains","getSelectedValues","reject","value","queryData","$","get","done","setOptions","push","uniq","focus","x","Component"],"mappings":"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","file":"Tokenizer.js","sourcesContent":["const KEY_TAB = 9\nconst KEY_ENTER = 13\nconst KEY_ESC = 27\n\nimport React from 'react'\nimport PropTypes from 'prop-types'\n\nexport default class Tokenizer extends React.Component {\n\n  static get propTypes() {\n    return {\n      placeholder: PropTypes.string,\n      remoteOptionsUrl: PropTypes.string,\n      queryParam: PropTypes.string,\n      selectedItems: PropTypes.array,\n      inputClassName: PropTypes.string,\n      optionListClassName: PropTypes.string,\n      optionClassName: PropTypes.string,\n      tokenListClassName: PropTypes.string,\n      tokenClassName: PropTypes.string,\n      removeButtonClassName: PropTypes.string,\n      leaveOpen: PropTypes.bool,\n      getItemValue: PropTypes.func,\n      getOptionComponent: PropTypes.func,\n      getTokenComponent: PropTypes.func,\n      getInputName: PropTypes.func,\n\n    }\n  }\n\n  static get defaultProps() {\n    return {\n      placeholder: '',\n      remoteOptionsUrl: null,\n      queryParam: 'q',\n      selectedItems: [],\n      inputClassName: 'RevTokenizer-input',\n      optionListClassName: 'RevTokenizer-options',\n      optionClassName: 'RevTokenizer-option',\n      tokenListClassName: 'RevTokenizer-tokens',\n      tokenClassName: 'RevTokenizer-token',\n      removeButtonClassName: 'RevTokenizer-remove',\n      leaveOpen: false,\n    }\n  }\n\n  constructor(props) {\n    super(props)\n\n    this.state = {\n      ignoreKeyUp: false,\n      optionItems: [],\n      selectedItems: this.props.selectedItems,\n    }\n  }\n\n  // Default is item.id\n  getItemValue(item) {\n    return (this.props.getItemValue || ((item) => item.id))(item)\n  }\n\n  getSelectedValues() {\n    return this.state.selectedItems.map(this.getItemValue.bind(this))\n  }\n\n  // Defaults to whatever getTokenComponent returns\n  getOptionComponent(item) {\n    return (this.props.getOptionComponent || this.getTokenComponent)(item)\n  }\n\n  // Defaults to JSON\n  getTokenComponent(item) {\n    return (this.props.getTokenComponent || JSON.stringify)(item)\n  }\n\n  // Default for <Tokenizer name=\"store[widgets]\" /> is <input name=\"store[widgets][]\" />\n  getInputName(item) {\n    return (this.props.getInputName || (() => `${this.props.name}`))(item)\n  }\n\n  // List item that contains @getTokenComponent(item) and a remove button\n  renderToken(item) {\n    return (\n      <li className={this.props.tokenClassName} key={`token-${this.getItemValue(item)}`}>\n        {this.getTokenComponent(item)}\n        <input\n          type=\"hidden\"\n          name={this.getInputName(item)}\n          value={this.getItemValue(item)}\n          readOnly\n        />\n        <a\n          className={this.props.removeButtonClassName}\n          href=\"#\"\n          onClick={() => this.onRemove(item)}\n        >\n          Remove\n        </a>\n      </li>\n    )\n  }\n\n  getInput() {\n    return this.refs.input.getDOMNode()\n  }\n\n  // List item that contains @getOptionComponent(item)\n  renderOption(item) {\n    return (\n      <li\n        className={this.props.optionClassName}\n        key={`option-${this.getItemValue(item)}`}\n        onClick={() => this.onSelect(item)}\n      >\n        {this.getOptionComponent(item)}\n      </li>\n    )\n  }\n\n  // Renders a list only if it has items\n  renderTokens() {\n    if(!this.state.selectedItems.length > 0) {\n      return null\n    }\n    return (\n      <ul className={this.props.tokenListClassName}>\n        {this.state.selectedItems.map(this.renderToken.bind(this))}\n      </ul>\n    )\n  }\n\n  // Renders a list only if it has items\n  renderOptions() {\n    if(!this.state.optionItems.length > 0) {\n      return null\n    }\n    return (\n      <ul className={this.props.optionListClassName}>\n        {this.state.optionItems.map(this.renderOption.bind(this))}\n      </ul>\n    )\n  }\n\n  render() {\n    return (\n      <div>\n        {this.renderTokens()}\n        <div className={this.props.className}>\n          <input\n            ref=\"input\"\n            type={this.props.type || 'text'}\n            className={this.props.inputClassName}\n            placeholder={this.props.placeholder}\n            defaultValue={this.props.defaultValue}\n            onKeyDown={this.onKeyDown.bind(this)}\n            onKeyUp={this.onKeyUp.bind(this)}\n            onBlur={this.onBlur.bind(this)}\n            onFocus={this.onFocus.bind(this)} />\n          {this.props.children}\n        </div>\n        {this.renderOptions()}\n      </div>\n    )\n  }\n\n  isSelectKey(e) {\n    return e.keyCode == KEY_TAB || e.keyCode == KEY_ENTER\n  }\n\n  onKeyDown(e) {\n    // prevent blur, form submit, etc.\n    // unless there's no text in the box, in which case we don't worry about it\n    return this.state.optionItems.length == 0 || !this.isSelectKey(e)\n  }\n\n  onKeyUp(e) {\n    if(this.isSelectKey(e)) {\n      // Select the first item on special keypresses\n      if(this.state.optionItems.length > 0) {\n        this.onSelect(this.state.optionItems[0])\n      }\n    }\n    else if(e.keyCode == KEY_ESC) {\n      // Esc to make the option go away\n      this.getInput().blur()\n    }\n    else {\n      this.fetchOptions()\n    }\n\n    this.setState({\n      ignoreKeyUp: false,\n    })\n  }\n\n  onBlur() {\n    if(this.props.leaveOpen) {\n      return\n    }\n    // If you don't delay this a little you can't click any of the options\n    clearOptions = () => this.setState({optionItems: []})\n    setTimeout(clearOptions, 200)\n  }\n\n  onFocus() {\n    this.fetchOptions()\n  }\n\n  clearOptions() {\n    if(this.xhr != null) {\n      this.xhr.abort()\n    }\n    this.setState({optionItems: []})\n  }\n\n  setOptions(items) {\n    rejectItem = (item) => _.contains(this.getSelectedValues(), this.getItemValue(item))\n    this.setState({\n      optionItems: _.reject(items, rejectItem),\n    })\n  }\n\n  fetchOptions() {\n    if(this.getInput().value == '') {\n      this.clearOptions()\n    }\n    else {\n      let queryData = {}\n      queryData[this.props.queryParam] = this.getInput().value\n      this.xhr = $.get(this.props.remoteOptionsUrl, queryData)\n      this.xhr.done(this.setOptions.bind(this))\n    }\n  }\n\n  onSelect(item) {\n    let items = this.state.selectedItems\n    items.push(item)\n    items = _.uniq(items, null, this.getItemValue.bind(this))\n    input = this.getInput()\n    input.value = ''\n    input.focus()\n    this.clearOptions()\n    this.setState({selectedItems: items})\n    return false\n  }\n\n  onRemove(item) {\n    const items = _.reject(this.state.selectedItems, (x) => this.getItemValue(x) == this.getItemValue(item))\n    this.setState({selectedItems: items})\n    return false\n  }\n}\n"]}